#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npm run typecheck

# Security check: prevent committing service role keys
echo "üîí Running security checks..."

if git diff --cached --name-only | grep -qE '\.(ts|tsx|js|jsx|json)$'; then
  # Check for service_role or SUPABASE_SERVICE_ROLE_KEY in staged files
  if git diff --cached | grep -iE '(service_role|SUPABASE_SERVICE_ROLE_KEY)'; then
    echo "‚ùå ERROR: Found 'service_role' or 'SUPABASE_SERVICE_ROLE_KEY' in staged files!"
    echo "This is a security risk. Service role keys must NEVER be committed."
    echo ""
    echo "Remove the key and use environment variables instead."
    exit 1
  fi
fi

echo "‚úÖ Security checks passed"
npx lint-staged
